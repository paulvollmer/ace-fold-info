<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="author" content="Paul Vollmer <paul.vollmer@fh-potsdam.de>">
  <title>ace-fold-info</title>
  <link rel='stylesheet' href='./stylesheets/style.css'/>
</head>
<body>
  <div class="navbar">
    <h3><a href="http://github.com/wrongentertainment/ace-fold-info">ace-fold-info</a></h3>
  </div>

  <div id="buttons_container">
    <button id="fold_all">Fold All</button>
    <button id="unfold_all">Unfold All</button>
    <script type="text/javascript">
      document.addEventListener('click', function(e) {
        if (e.target.id === 'fold_all') {
          //console.log('fold_all');
          editor.session.foldAll();
        };
        if (e.target.id === 'unfold_all') {
          //console.log('unfold_all');
          editor.session.unfold();
        };
      }, false);
    </script>
  </div>

  <div id="editor_container">
    <div id="editor_addon"></div>
    <div id="editor">/**
 * ace-fold-info
 * This is a small demo of the 'ace fold info' experiment.
 */

console.log('hello ace editor');

function square(a) {
  return rectArea(a, a);
}

function rectArea(a, b) {
  var result = a*b;
  return result;
}
</div>
    <script src="./javascripts/ace/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="./javascripts/main.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
      /**
       * Create a new ace editor instance and setup some settings.
       */
      var editor = ace.edit("editor");
      editor.setTheme("ace/theme/tomorrow");
      editor.getSession().setMode("ace/mode/javascript", function() {
        // Fold the content
        editor.session.foldAll();

        foldInfo.graph();
      });

      /**
       * input functions on change event...
       */
      editor.getSession().on('change',function(){
        update();
      });

      editor.getSession().on('changeFold',function(){
        //console.log('-> changeFold');
        foldInfo.graph();
      });

      /**
       * Some ace editor helper functions we need.
       */
      var editorHelper = {
        /**
         * Set the height of the editor.
         * Note: ace get slow if too many lines.
         */
        setHeight: function(height) {
          document.getElementById('editor').style.height = height+'px';
        }
      };

      /**
       * Update function
       */
      function update() {
        var tmpEditorLength = editor.getSession().getDocument().getLength();

        if (tmpEditorLength < 20) {
          var tmpHeight = editor.renderer.lineHeight*20;
          //editorSetHeight(tmpHeight);
          editorHelper.setHeight(tmpHeight);

          aceAddon.setHeight(tmpHeight);
          aceAddon.addGutters(tmpEditorLength);
          foldInfo.graph();
        } else {
          var tmpHeight = tmpEditorLength * editor.renderer.lineHeight;
          //editorSetHeight(tmpHeight);
          editorHelper.setHeight(tmpHeight);

          aceAddon.setHeight(tmpHeight);
          aceAddon.addGutters(tmpEditorLength);
          foldInfo.graph();
        }
      }

      update();

    </script>
  </div>

</body>
</html>
